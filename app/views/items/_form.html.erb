<%= form_for [@property, @item] do |f| %>
  <% if @item.errors.any? %>
    <div id="error_explanation">
      <h2><%= pluralize(@item.errors.count, "error") %> prohibited this item from being saved:</h2>

      <ul>
      <% @item.errors.full_messages.each do |message| %>
        <li><%= message %></li>
      <% end %>
      </ul>
    </div>
  <% end %>
  <div>

  </div>
  <div class="row first-row">
    <div class="columns large-12">
      <%= f.label :name %><br>
      <%= f.text_area :name %>
    </div>
  </div>

  <div class="row">
    <div class="columns large-12">
      <%= f.label :notes %><br>
      <%= f.text_area :notes %>
    </div>
  </div>

  <div class="row">
    <div class="columns large-12">
      <%= f.label :last_maintenance_at %>
      <br/>
    </div>
    <div class="columns large-6">
      <select name="item[last_maintenance_at][month]">
        <option value="" <%= 'selected' unless @item.last_maintenance_at %> >Please select</option>
        <%= Property::MONTHS.each do |month| %>
          <option value="<%= month %>" <%= 'selected' if @item.last_maintenance_at && @item.last_maintenance_at.strftime('%B') == month %>><%= month %></option>
        <% end %>
      </select>
    </div>
    <div class="columns large-6">
      <select name="item[last_maintenance_at][year]">
        <option value="" <%= 'selected' unless @item.last_maintenance_at %> >Please select</option>
        <%= (1990..Time.now.year).to_a.reverse.each do |year| %>
          <option value="<%= year %>" <%= 'selected' if @item.last_maintenance_at && @item.last_maintenance_at.strftime('%Y') == year %>><%= year %></option>
        <% end %>
      </select>
    </div>
  </div>
  <div class="row">
    <div class="columns large-12">
      <label for="item_frequency">Frequency <i>(Optional)</i>
        <select name="item[frequency]">
          <option value="" selected="selected">Please select</option>
          <option value="daily">Daily</option>
          <option value="weekly">Weekly</option>
          <option value="monthly">Monthly</option>
          <option value="quarterly">Quarterly</option>
          <option value="biannually">Twice per year</option>
          <option value="annually">Annually</option>
        </select>
      </label>
    </div>
  </div>
  <div class="row">
    <div class="columns large-12">
      <% if @item.attachments? %>
        <div class="row">
          <% attachment_count = @item.attachments.count %>
          <% @item.attachments.each_with_index do |attachment, index| %>
            <div class="columns large-4 <%= 'end' if attachment_count == (index + 1) %>">
              <label for="remove_attachment">Remove file:
                <input type="hidden" name="remove_attachment" value="0" selected>
                <input type="checkbox" name="remove_attachment" value="1">
              </label>
              <div style="padding:10px;">
                <!-- TODO if PDF add PDF thumbnail placeholder -->
                <%= image_tag(attachment.url) %>
              </div>
            </div>
          <% end %>
        </div>
      <% end %>
      <%= f.label :attachments %><br>
      <%= f.file_field :attachments, multiple: true %>
      <%# f.hidden_field :attachments_cache %>
    </div>
  </div>
  <div class="actions">
    <%= f.submit @item.new_record? ? 'Create item' : 'Update item', class: 'button' %>
  </div>
<% end %>

<%= javascript_include_tag 'properties' %>